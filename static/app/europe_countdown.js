// Generated by CoffeeScript 1.10.0
App.module("Countdown", function(Mod, App, Backbone, Marionette, $, _) {
  var Countdown, CountdownItemView, _options, handler, model, view;
  Mod.startWithParent = false;
  _options = void 0;
  model = void 0;
  view = void 0;
  Countdown = Backbone.Model.extend({
    defaults: {
      number: 3
    }
  });
  CountdownItemView = Marionette.ItemView.extend({
    template: function(serialized_model) {
      return _.template("<h1><%= display_number() %></h1>")(serialized_model);
    },
    templateHelpers: function() {
      return {
        display_number: function() {
          if (this.number > 0) {
            return this.number;
          } else {
            return 'Start!';
          }
        }
      };
    },
    initialize: function(options) {
      return this.model.on('change', (function(_this) {
        return function() {
          return _this.render();
        };
      })(this));
    },
    onDestroy: function() {
      return this.model.off('change');
    }
  });
  handler = function() {
    var number;
    number = model.get('number');
    model.set('number', number - 1);
    if (number === 0) {
      clear_timer();
      return window.channel.command('countdown:close', _options);
    } else if (number === 1) {
      return window.sfx.honk.play();
    } else {
      return window.sfx.button.play();
    }
  };
  Mod.onStart = function(options) {
    console.log('Countdown module');
    console.log(options);
    _options = options;
    model = new Countdown();
    view = new CountdownItemView({
      model: model,
      el: make_content_wrapper()
    });
    view.render();
    return set_timer(handler, _options.options.COUNTDOWN_TICK_TIMEOUT);
  };
  return Mod.onStop = function() {
    clear_timer();
    view.destroy();
    return model = void 0;
  };
});
